# 顔認識Webアプリ「ゼロcam」

## 1. 概要

本アプリケーションは、PCまたはモバイル端末のカメラを使用し、リアルタイムでユーザーの顔と表情を認識するWebアプリケーションである。ユーザーの特定の表情（口を開ける、ウィンクする）を検出し、それに応じて指定された画像をカメラ映像に重畳して表示する。

すべての処理はユーザーのブラウザ（フロントエンド）内で完結し、サーバーサイドでの処理や画像データの送信は一切行わない。

## 2. 機能要件

### 2.1. 顔・表情検出機能

-   **リアルタイム検出**: カメラ映像から、毎秒複数回の頻度で顔の位置、輪郭、および各パーツ（目、口など）を検出する。
-   **口の開閉判定**: 顔のパーツの座標を基に、口が一定以上開いている状態を判定する。
-   **ウィンク判定**: 左右の目の開閉状態を個別に認識し、片方の目だけが閉じている状態（ウィンク）を判定する。

### 2.2. 画像重畳表示機能

-   **口を開けた際の表示**: ユーザーが口を開けたと判定された場合、顔全体の位置とサイズに合わせて、指定された連番画像（`mouse00.png` ~ `mouse03.png`）をアニメーション表示する。
    -   アニメーションは認識処理の周期ごとにフレームが進む。
-   **ウィンクした際の表示**: ユーザーがウィンクしたと判定された場合、閉じている方の目の位置に合わせて、指定された画像（`wink_eye.png`）を表示する。
-   **アスペクト比の維持**: 重畳表示するすべての画像は、元の画像のアスペクト比（縦横比）を維持したまま表示される。
-   **鏡写し対応**: カメラ映像はユーザーにとって自然な鏡写し（左右反転）で表示される。重畳する画像は、文字などが含まれていても正しい向きで表示されるように自動で反転補正される。

### 2.3. ユーザーインターフェース (UI) 機能

-   **設定パネル**: 以下のパラメータをリアルタイムで調整可能なUIを提供する。
    -   **解像度**: カメラの入力解像度を `640x480` と `1280x720` から選択可能。
    -   **処理周期**: 顔認識処理を実行する間隔を100msから1000msの範囲で調整可能。
    -   **目の閾値**: 目が「閉じている」と判定されるアスペクト比の閾値を調整可能。
    -   **開いている目の倍率**: ウィンク判定時に、開いている方の目が閉じている方の目よりどれだけ大きいかを判定するための倍率を調整可能。
    -   **口の閾値**: 口が「開いている」と判定される、顔の高さに対する口の開きの比率の閾値を調整可能。
-   **リアルタイム情報パネル**: 以下の検出値を数値でリアルタイムに表示し、パラメータ調整の参考にする。
    -   左目アスペクト比
    -   右目アスペクト比
    -   口の開き具合
-   **UI表示切り替え**: 「設定」ボタンにより、設定パネルとリアルタイム情報パネルの表示・非表示を切り替え可能。

## 3. 非機能要件

### 3.1. 動作環境

-   **対応ブラウザ**: WebカメラへのアクセスAPI (`getUserMedia`) および `face-api.js` が動作するモダンなWebブラウザ（Google Chrome, Firefox, Safari, Microsoft Edge の最新版）。
-   **デバイス**: インカメラまたはWebカメラを搭載したPC、スマートフォン、タブレット。
-   **通信**: アプリケーションの動作には、カメラ機能へのアクセス許可のため、HTTPSによる通信が必須である。

### 3.2. パフォーマンス

-   **処理の軽量化**: 顔検出モデルには、モバイルデバイスでも比較的軽快に動作する `TinyFaceDetector` を使用する。
-   **入力サイズの最適化**: 検出処理の入力画像サイズを `320x320` に固定することで、カメラ解像度の違いによるパフォーマンスのばらつきを抑制し、安定した動作を目指す。

### 3.3. セキュリティ・プライバシー

-   **クライアントサイド処理**: すべての画像処理はユーザーのブラウザ内で完結する。カメラ映像や個人を特定するデータが外部サーバーに送信されることは一切ない。
-   **カメラアクセス**: ブラウザの標準機能に基づき、ユーザーの明示的な許可があった場合にのみカメラにアクセスする。

## 4. システム構成

### 4.1. 使用技術

| 分類 | 技術・ライブラリ | 目的 |
| :--- | :--- | :--- |
| **フロントエンド** | HTML, CSS, JavaScript | Webアプリケーションの基本的な構造、デザイン、ロジックの実装 |
| **顔認識** | `face-api.js` | カメラ映像からの顔・表情のリアルタイム検出 |
| **描画** | HTML `<canvas>` | カメラ映像と重畳画像を描画 |
| **ホスティング** | 静的サイトホスティングサービス (例: GitHub Pages) | アプリケーションの公開 |

### 4.2. ファイル構成
```
.
├── index.html         # アプリケーションの骨格となるHTMLファイル
├── style.css          # デザインを定義するCSSファイル
├── script.js          # アプリケーションの全ロジックを記述するJSファイル
├── images/
│   ├── mouse00.png    # 口を開けた際に表示する画像1
│   ├── mouse01.png    # 口を開けた際に表示する画像2
│   ├── mouse02.png    # 口を開けた際に表示する画像3
│   ├── mouse03.png    # 口を開けた際に表示する画像4
│   └── wink_eye.png   # ウィンクした際に表示する画像
└── models/            # face-api.js用の学習済みモデルファイル群
    ├── ...
    └── ...
```