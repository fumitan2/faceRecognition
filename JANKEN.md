# 顔認識じゃんけんアプリ 「じゃんCam」

## 1. 概要

本アプリケーションは、PCに接続されたウェブカメラを使用し、ユーザーの顔の表情（ウインクや口の開き具合）をリアルタイムで認識して、コンピュータと「じゃんけん」をプレイするウェブアプリケーションである。

## 2. 目的

-   `face-api.js`ライブラリを活用した顔認識技術の実践的なデモンストレーション。
-   ユーザーが直感的かつ身体的に操作できる、新しいインターフェースの体験を提供する。
-   インタラクティブなウェブコンテンツ開発のサンプル事例とする。

## 3. 機能一覧

-   **顔認識機能**
    -   ウェブカメラ映像からリアルタイムに顔を検出する。
    -   顔のランドマーク（目、口などの位置）を取得する。
    -   目（左右）と口の開き具合を数値化して表示する。
-   **じゃんけんゲーム機能**
    -   ユーザーの表情（左目ウインク、右目ウインク、口を開く）を手（グー、チョキ、パー）として判定する。
    -   コンピュータの手をランダムに選択する。
    -   勝敗を判定し、結果を表示する。
    -   「あいこ」の場合、自動的に再試合を行う。
-   **音声再生機能**
    -   ゲームの進行に合わせて効果音を再生する（じゃんけんぽん、勝ち、負け、あいこ）。
-   **設定・UI機能**
    -   手の判定に使われる閾値（目の感度、口の感度）をスライダーで調整可能。
    -   現在の表情がどの手に判定されるかをリアルタイムで表示する。
    -   設定・情報パネルの表示/非表示を切り替え可能。
    -   トップページとじゃんけんゲームページ間の画面遷移。

## 4. 画面構成

本アプリケーションは、以下の2つの主要な画面で構成される。

| 画面名 | ファイル名 | 役割 |
| :--- | :--- | :--- |
| トップページ | `index.html` | 顔認識の基本機能のデモと、ゲームへの入り口。 |
| じゃんけんゲームページ | `janken.html` | メインのじゃんけんゲームをプレイする画面。 |

## 5. 画面詳細仕様

### 5.1. トップページ (`index.html`)

顔認識の基本的な動作を確認するためのページ。

| 要素 | 機能 |
| :--- | :--- |
| **カメラ映像エリア** | ウェブカメラの映像をリアルタイムで表示する。映像は左右反転して表示される。 |
| **設定パネル** | 顔認識の各種パラメータを調整するUI。（`設定`ボタンで表示/非表示）<br>・解像度<br>・処理周期<br>・目の閾値<br>・開いている目の倍率<br>・口の閾値 |
| **リアルタイム情報パネル** | 認識された顔の各パーツの計算値をリアルタイムで表示する。<br>・左目アスペクト比<br>・右目アスペクト比<br>・口の開き具合 |
| **じゃんけんゲームへの遷移ボタン** | クリックすると `janken.html` に遷移する。 |

### 5.2. じゃんけんゲームページ (`janken.html`)

じゃんけんをプレイするためのメインページ。

| 要素 | 機能 |
| :--- | :--- |
| **カメラ映像エリア (背景)** | 画面全体の背景として、ウェブカメラの映像をリアルタイムで表示する。 |
| **ゲーム操作パネル (左)** | ゲームの進行状況と操作を行う。<br>・**カウントダウン表示**: `じゃん、けん、ポン！`、`あい、こで、しょ！`と表示。<br>・**対戦結果表示**: ユーザーとコンピュータが出した手を表示。<br>・**勝敗結果表示**: `勝ち！🎉`, `負け...😢`, `あいこ` などを表示。<br>・**「じゃんけんポン！」ボタン**: ゲームを開始する。<br>・**「トップへ戻る」ボタン**: `index.html` に戻る。 |
| **情報・設定パネル (右)** | ユーザーへのフィードバックと設定変更を行う。<br>・**「設定を隠す/表示」ボタン**: このパネル自体の表示/非表示を切り替える。<br>・**リアルタイム情報**: 現在の目と口の開き具合を数値で表示。<br>・**感度設定スライダー**: 目の閉じ閾値と口の開き閾値を調整可能。<br>・**現在の判定**: 現在の表情がどの手として判定されるかをリアルタイムで表示。<br>・**「ポン」の瞬間の値**: 判定が確定した瞬間の各パラメータ値を表示。 |

## 6. コア機能詳細

### 6.1. 顔認識とパラメータ計算

-   **使用ライブラリ**: `face-api.js` (tinyFaceDetector, faceLandmark68TinyNet)
-   **目の開き具合**: 顔ランドマークから取得した目の6点の座標を元に、**EAR (Eye Aspect Ratio)** を計算。値が小さいほど目が閉じていると判定。
-   **口の開き具合**: 顔ランドマークから取得した内唇の上下の距離と、顔全体の高さの比率を計算。値が大きいほど口が開いていると判定。

### 6.2. じゃんけんの手の判定ロジック

「ポン」または「しょ」のタイミングで取得された顔のパラメータに基づき、以下の優先順位でユーザーの手を判定する。

| 優先度 | 手 | 絵文字 | 条件 |
| :--- | :--- | :--- | :--- |
| 1 (高) | **パー** | ✋ | 口の開き具合が「口の閾値」スライダーで設定した値より大きい。 |
| 2 (中) | **グー** | ✊ | **左目**のEARが「目の閾値」より小さく、かつ**右目**のEARが閾値より大きい（左目ウインク）。 |
| 3 (低) | **チョキ** | ✌️ | **右目**のEARが「目の閾値」より小さく、かつ**左目**のEARが閾値より大きい（右目ウインク）。 |
| 4 (デフォルト) | **グー** | ✊ | 上記のいずれの条件にも当てはまらない場合。 |

### 6.3. ゲームフロー

1.  ユーザーが「じゃんけんポン！」ボタンをクリックする。
2.  `じゃん` (1秒) → `けん` (1秒) → `ポン！` とカウントダウンが表示される。
3.  「ポン！」のタイミングでユーザーの顔の状態をスナップショットとして取得し、手を判定する。
4.  コンピュータの手をランダムに決定する。
5.  勝敗を判定し、結果を表示する。
6.  **あいこの場合**: `あい`→`こで`→`しょ！`とカウントダウンが表示され、再度ステップ3から繰り返す。
7.  勝敗が決定した場合、ゲームが終了し、ボタンが再度押せるようになる。

## 7. 音声仕様

ゲームの各場面で、以下の音声ファイルが再生される。

| 音声ファイル | 再生タイミング |
| :--- | :--- |
| `jankenpon.m4a` | 「ポン！」の表示と同時。 |
| `aikodesho.m4a` | 「あいこで...」の表示と同時。 |
| `yappy.m4a` | ユーザーが勝利した時。 |
| `zuko.m4a` | ユーザーが敗北した時。 |

## 8. 技術仕様

| 分類 | 技術 | 目的 |
| :--- | :--- | :--- |
| **フロントエンド** | HTML, CSS, JavaScript (ES6) | アプリケーションの構造、デザイン、ロジックの実装 |
| **顔認識ライブラリ** | `face-api.js` (ver 0.22.2) | 顔検出とランドマークの特定 |
| **ローカル開発環境** | `python -m http.server` | ローカルでのウェブサーバー起動 |

## 9. ファイル構成
```
.
├── index.html            # トップページ
├── janken.html           # じゃんけんゲームページ
├── style.css             # スタイルシート
├── script.js             # トップページ用スクリプト
├── janken.js             # じゃんけんゲーム用スクリプト
├── models/               # face-api.jsの学習済みモデルファイル群
│   ├── tiny_face_detector_model-shard1
│   ├── tiny_face_detector_model-weights_manifest.json
│   └── ...
├── images/               # 画像ファイル (今回は未使用)
│   ├── mouth_open.png
│   └── wink_eye.png
└── audio/                # (推奨) 音声ファイル
    ├── jankenpon.m4a
    ├── aikodesho.m4a
    ├── yappy.m4a
    └── zuko.m4a
``` 

※ 音声ファイルはルートディレクトリに配置しても動作する。

## 10. 動作環境・前提条件

-   **ハードウェア**: PCにウェブカメラが接続されていること。
-   **ブラウザ**: モダンブラウザであること (Google Chrome, Microsoft Edge, Firefoxなど)。
    -   **WebGL**がサポートされ、**ハードウェアアクセラレーションが有効**になっている必要がある。
-   **モデルファイル**: `models`フォルダがHTMLファイルと同じ階層に正しく配置されていること。
-   **サーバー**: `http://` または `https://` 経由でアクセスすること。ローカルファイル(`file:///`)として直接開いた場合、カメラへのアクセスが制限され動作しない。